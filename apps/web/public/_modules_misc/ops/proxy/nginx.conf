map $http_origin $cors_origin {
  default "";
  https://nexaai.co.uk https://nexaai.co.uk;
  https://www.nexaai.co.uk https://www.nexaai.co.uk;
}

location ^~ /_next/static/ {
  add_header Cache-Control "public, max-age=31536000, immutable" always;
  try_files $uri $uri/ =404;
}

location ^~ /api/ {
  proxy_set_header Host $host;
  proxy_pass http://127.0.0.1:3000;  # adjust upstream if different
  add_header Cache-Control "no-store" always;
  add_header Access-Control-Allow-Origin $cors_origin always;
  add_header Vary "Origin" always;

  if ($request_method = OPTIONS) {
    add_header Access-Control-Allow-Methods "GET,POST,PUT,PATCH,DELETE,OPTIONS" always;
    add_header Access-Control-Allow-Headers "Content-Type, Authorization" always;
    add_header Access-Control-Max-Age "600" always;
    return 204;
  }
}

location / {
  proxy_set_header Host $host;
  proxy_pass http://127.0.0.1:3000;  # adjust upstream if different
  add_header Cache-Control "s-maxage=60, stale-while-revalidate=300" always;
}



