import type { GetServerSideProps } from "next";
import { getServerSession } from "next-auth/next";
import { authOptions } from "../src/lib/auth/options";

type Props = { email: string | null };

export default function Dashboard({ email }: Props){
  return <div style={{padding:24,fontFamily:"ui-sans-serif,system-ui"}}>
    <h1>Nexa ERP â€” Dashboard</h1>
    <p>Signed in as <b>{email ?? "unknown"}</b></p>
    <p><a href="/api/auth/signout?callbackUrl=/login">Sign out</a></p>
  </div>;
}

export const getServerSideProps: GetServerSideProps<Props> = async (ctx) => {
  try {
    const session = await getServerSession(ctx.req, ctx.res, authOptions);
    if (!session) return { redirect: { destination: "/login?callbackUrl=/dashboard", permanent: false } };
    return { props: { email: (session.user as any)?.email ?? null } };
  } catch (e) {
    console.error("dashboard gSSP error:", e);
    return { redirect: { destination: "/login?callbackUrl=/dashboard", permanent: false } };
  }
};
