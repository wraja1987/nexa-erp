const { execSync } = require("node:child_process"); const routes = ["/app/dashboard","/admin"]; const budgets = { performance: 85, accessibility: 90, "best-practices": 90, seo: 80 }; let fail = 0; for (const r of routes) { const url = `http://localhost:3000${r}`; const out = execSync(`npx -y lighthouse ${url} --quiet --chrome-flags="--headless=new" --only-categories=performance,accessibility,best-practices,seo --output=json --output-path=stdout`, { stdio: ["ignore","pipe","inherit"] }).toString(); const rep = JSON.parse(out); const scores = Object.fromEntries(Object.entries(rep.categories).map(([k,v]) => [k, Math.round(v.score*100)])); console.log("LH", r, scores); Object.entries(budgets).forEach(([k, min]) => { if ((scores[k]||0) < min) { console.error("Budget fail", r, k, scores[k], "<", min); fail++; } }); } process.exit(fail ? 1 : 0);
